<h1>Listing Portfolios</h1>

<% def show(col)
p = params.clone
p['hidden'] -= [col]
return p
end %>

<% if @hidden_cols.include?('purpose') %>
  <%= link_to 'Purpose', show('purpose') %>
<% end %>
<% if @hidden_cols.include?('creation_date') %>
  <%= link_to 'Creation date', show('creation_date') %>
<% end %>
<% if @hidden_cols.include?('principal') %>
  <%= link_to 'Principal', show('principal') %>
<% end %>
<% if @hidden_cols.include?('cash') %>
  <%= link_to 'Cash', show('cash') %>
<% end %>
<% if @hidden_cols.include?('owner_id') %>
  <%= link_to 'Owner', show('owner_id') %>
<% end %>
<% if @hidden_cols.include?('manager_id') %>
  <%= link_to 'Manager', show('manager_id') %>
<% end %>

<table>
  <thead>
    <tr>
      <% unless @hidden_cols.include?('purpose') %>
        <th>
          <%= link_to 'Purpose', params.merge('hidden[]' => 'purpose') %>
        </th>
      <% end %>
      <% unless @hidden_cols.include?('creation_date') %>
        <th>
          <%= link_to 'Creation date', params.merge('hidden[]' => 'creation_date') %>
        </th>
      <% end %>
      <% unless @hidden_cols.include?('principal') %>
        <th>
          <%= link_to 'Principal', params.merge('hidden[]' => 'principal') %>
        </th>
      <% end %>
      <% unless @hidden_cols.include?('cash') %>
        <th>
          <%= link_to 'Cash', params.merge('hidden[]' => 'cash') %>
        </th>
      <% end %>
      <% unless @hidden_cols.include?('owner_id') %>
        <th>
          <%= link_to 'Owner', params.merge('hidden[]' => 'owner_id') %>
        </th>
      <% end %>
      <% unless @hidden_cols.include?('manager_id') %>
        <th>
          <%= link_to 'Manager', params.merge('hidden[]' => 'manager_id') %>
        </th>
      <% end %>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @portfolios.each do |portfolio| %>
      <tr>
        <% unless @hidden_cols.include?('purpose') %>
          <td><%= portfolio.purpose %></td>
        <% end %>
        <% unless @hidden_cols.include?('creation_date') %>
          <td><%= portfolio.creation_date %></td>
        <% end %>
        <% unless @hidden_cols.include?('principal') %>
          <td><%= portfolio.principal %></td>
        <% end %>
        <% unless @hidden_cols.include?('cash') %>
          <td><%= portfolio.cash %></td>
        <% end %>
        <% unless @hidden_cols.include?('owner_id') %>
          <td><%= link_to portfolio.owner.name, portfolio.owner %></td>
        <% end %>
        <% unless @hidden_cols.include?('manager_id') %>
          <td><%= link_to portfolio.manager.name, portfolio.manager %></td>
        <% end %>
        <td><%= link_to 'Show', portfolio %></td>
        <td><%= link_to 'Edit', edit_portfolio_path(portfolio) %></td>
        <td><%= link_to 'Destroy', portfolio, method: :delete,
                        data: { confirm: "Are you sure?\n\nAll holdings in the portfolio (if any) will be deleted as well!" } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Portfolio', new_portfolio_path %>
