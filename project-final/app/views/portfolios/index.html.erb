<h1>Listing Portfolios</h1>

<script type="text/template" id="st">
<select class="col">
	<option value="cash">Cash</option>
	<option value="principal">Principal</option>
</select>
<select class="op">
	<option value="lt">&lt;</option>
	<option value="le">&lt;=</option>
	<option value="eq">=</option>
	<option value="ne">!=</option>
	<option value="ge">&gt;=</option>
	<option value="gt">&gt;</option>
</select>
<input type="text">
<button class="remove">-</button>
</script>
<script type="text/template" id="sc">
<select name="contains[]" class="stock">
<% Stock.all.each do |s| %>
   <option><%= s.symbol %></option>
<% end %>
</select>
<button class="remove">-</button>
</script>

<%= form_tag("", method: "get", id: "filter") do %>
	<strong>Hidden columns:</strong>
	<%= check_box_tag("hidden[]", "purpose", @hidden_cols.include?('purpose'), id: "purpose_hidden") %>
	<%= label_tag("purpose_hidden", "Purpose") %>
	<%= check_box_tag("hidden[]", "creation_date", @hidden_cols.include?('creation_date'), id: "creation_hidden") %>
	<%= label_tag("creation_hidden", "Creation date") %>
	<%= check_box_tag("hidden[]", "principal", @hidden_cols.include?('principal'), id: "principal_hidden") %>
	<%= label_tag("principal_hidden", "Principal") %>
	<%= check_box_tag("hidden[]", "cash", @hidden_cols.include?('cash'), id: "cash_hidden") %>
	<%= label_tag("cash_hidden", "Cash") %>
	<%= check_box_tag("hidden[]", "owner_id", @hidden_cols.include?('owner_id'), id: "owner_hidden") %>
	<%= label_tag("owner_hidden", "Owner") %>
	<%= check_box_tag("hidden[]", "manager_id", @hidden_cols.include?('manager_id'), id: "manager_hidden") %>
	<%= label_tag("manager_hidden", "Manager") %>
	<br>
	<strong>Filters:</strong>
	<button id="add">+</button>
	<div class="filters">
		<% if params[:filter] then params[:filter].each do |filter| %>
			<% filter[1].each do |f| %>
				<div class="selection">
					<select class="col">
						<option value="cash" <%= if (filter[0] == 'cash') then 'selected' end %>>Cash</option>
						<option value="principal" <%= if (filter[0] == 'principal') then 'selected' end %>>Principal</option>
					</select>
					<select class="op">
						<option value="lt" <%= if (f[0] == 'lt') then 'selected' end %>>&lt;</option>
						<option value="le" <%= if (f[0] == 'le') then 'selected' end %>>&lt;=</option>
						<option value="eq" <%= if (f[0] == 'eq') then 'selected' end %>>=</option>
						<option value="ne" <%= if (f[0] == 'ne') then 'selected' end %>>!=</option>
						<option value="ge" <%= if (f[0] == 'ge') then 'selected' end %>>&gt;=</option>
						<option value="gt" <%= if (f[0] == 'gt') then 'selected' end %>>&gt;</option>
					</select>
					<input type="text" value="<%= f[1] %>">
					<button class="remove">-</button>
				</div>
			<% end %>
		<% end
		end %>
	</div>
	<strong>Stocks:</strong>
	<button id="sadd">+</button>
	<div class="stocks">
		<% if params[:contains] then params[:contains].each do |ss| %>
			<div class="sf">
				<select name="contains[]" class="stock">
					<% Stock.all.each do |s| %>
						<option <%= if (ss == s.symbol) then 'selected' end %>><%= s.symbol %></option>
					<% end %>
				</select>
				<button class="remove">-</button>
			</div>
		<% end
		end	%>
	</div>
	<%= submit_tag("Filter") %>
<% end %>

<table>
	<thead>
		<tr>
			<% unless @hidden_cols.include?('purpose') %>
				<th>
					Purpose
				</th>
			<% end %>
			<% unless @hidden_cols.include?('creation_date') %>
				<th>
					Creation date
				</th>
			<% end %>
			<% unless @hidden_cols.include?('principal') %>
				<th>
					Principal
				</th>
			<% end %>
			<% unless @hidden_cols.include?('cash') %>
				<th>
					Cash
				</th>
			<% end %>
			<% unless @hidden_cols.include?('owner_id') %>
				<th>
					Owner
				</th>
			<% end %>
			<% unless @hidden_cols.include?('manager_id') %>
				<th>
					Manager
				</th>
			<% end %>
			<th colspan="3"></th>
		</tr>
	</thead>

	<tbody>
		<% @portfolios.each do |portfolio| %>
			<tr>
				<% unless @hidden_cols.include?('purpose') %>
					<td><%= portfolio.purpose %></td>
				<% end %>
				<% unless @hidden_cols.include?('creation_date') %>
					<td><%= portfolio.creation_date %></td>
				<% end %>
				<% unless @hidden_cols.include?('principal') %>
					<td><%= portfolio.principal %></td>
				<% end %>
				<% unless @hidden_cols.include?('cash') %>
					<td><%= portfolio.cash %></td>
				<% end %>
				<% unless @hidden_cols.include?('owner_id') %>
					<td><%= link_to portfolio.owner.name, portfolio.owner %></td>
				<% end %>
				<% unless @hidden_cols.include?('manager_id') %>
					<td><%= link_to portfolio.manager.name, portfolio.manager %></td>
				<% end %>
				<td><%= link_to 'Show', portfolio %></td>
				<td><%= link_to 'Edit', edit_portfolio_path(portfolio) %></td>
				<td><%= link_to 'Destroy', portfolio, method: :delete,
					data: { confirm: "Are you sure?\n\nAll holdings in the portfolio (if any) will be deleted as well!" } %></td>
			</tr>
		<% end %>
	</tbody>
</table>

<br>

<%= link_to 'New Portfolio', new_portfolio_path %>
