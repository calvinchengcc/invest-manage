\documentclass[letterpaper]{report}
\usepackage[margin=1in]{geometry}
\parindent 0pt
\parskip 1em
\begin{document}
{\large \textbf{CPSC 304} 2015W2 \\ \textbf{Project Part II}}

\section*{Group Members}
\begin{tabular}{l l l l}
	\hline\hline\noalign{\vskip 1ex}
	\textbf{Name} & \textbf{Student No.} & \textbf{Unix ID} & \textbf{Email} \\ \noalign{\vskip .4ex}\hline\noalign{\vskip .8ex}
	Albert Xing & 40640104 & z6k8 & albert.xing@alumni.ubc.ca \\
	Calvin Cheng & 36090132 & o7x8 & calvin.cheng@alumni.ubc.ca \\
	Kyle Stadnyk & 52749025 & b5p5 & b5p5@ugrad.cs.ubc.ca \\
	\noalign{\vskip 1ex}\hline
\end{tabular}

By typing our names and student numbers in the above table, we certify that the work in the attached assignment was performed solely by those whose names and student IDs are included above.

In addition, we indicate that we are fully aware of the hrules and consequences of plagiarism, as set forth by the Department of Computer Science and the University of British Columbia.

\section*{ER Diagram}
Please find the ER diagram in a separate folder {\sffamily ER-Diagram}.

\section*{Database Schemas}

\hangindent .25in
{\sffamily Stock(\underline{symbol}: CHAR(6), \underline{exchange}: CHAR(6), name: VARCHAR(64))} \\
Primary key: {\sffamily (symbol, exchange)} \\
Functional dependencies: $symbol, exchange \to name$ \\\\
The {\sffamily Stock} entity represents a single stock, identified by a symbol and the exchange it is traded in. The given FD asserts that a unique symbol and exchange implies the name of the stock.

\hangindent .25in
{\sffamily Holding(\underline{holding\_id}: INT, \underline{portfolio\_id}: INT, symbol: CHAR(6), exchange: CHAR(6), num\_shares: INT, date: DATE, time: TIME, price: INT)} \\
Primary key: {\sffamily (holding\_id, portfolio\_id)} \\
Foreign key: {\sffamily portfolio\_id} references {\sffamily Portfolio} \\
Foreign key: {\sffamily (symbol, exchange)} references {\sffamily Stock} \\
Functional dependencies: $holding\_id, portfolio\_id \to symbol, exchange, date, time, price$ \\\\
A {\sffamily Holding} is a number of shares of a stock inside a portfolio, with the date, time, and price the shares were bought for. The FD states that a holding can be uniquely identified by a {\sffamily holding\_id} and the ID of the portfolio in which it belongs.

\hangindent .25in
{\sffamily Portfolio(\underline{id}: INT, purpose: VARCHAR(64), creation\_date: DATE, principal: INT, cash: INT, owner\_id: INT, manager\_id: INT)} \\
Primary key: {\sffamily id} \\
Foreign key: {\sffamily owner\_id} references {\sffamily User} \\
Foreign key: {\sffamily manager\_id} references {\sffamily User} \\
Functional dependencies: $id \to purpose, creation\_date, principal, cash, owner\_id, manager\_id$ \\\\
A {\sffamily Portfolio} is a collection of stock holdings for a particular purpose. The FD states that a portfolio can be identified by its unique ID. Also note that portfolios for self-directed investors are both owned and managed by the same investor, while managed portfolios are owned by an investor and managed by an advisor.


\hangindent .25in
{\sffamily User(\underline{id}: INT, name: VARCHAR(64), email: VARCHAR(64), phone: CHAR(10), password: BINARY(60), address\_id: INT)}\\
Primary key: {\sffamily id} \\
Foreign key: {\sffamily address\_id} references {\sffamily Address} \\
Functional dependencies: $id \to name, email, phone, password, address\_id$ \\\\
{\sffamily User}s are either investors (who provide principal), advisors (who trade on behalf of investors), or self-directed investors (who assume both roles). Each user has a unique ID, as the FD states, through which they can be identified. We decided not to include \textsf{email} as a candidate key because it may be the case that a single individual would wish to open multiple accounts, for example a financial advisor who wants to open a separate individual account for their own use.

\hangindent .25in
{\sffamily Address(\underline{id}: INT, number: CHAR(5), street: VARCHAR(32), city: VARCHAR(32), country: VARCHAR(32), postal\_code: CHAR(6))}\\
Primary key: {\sffamily id} \\
Functional dependencies: $id \to number, street, city, country, postal\_code$ \\\\
An {\sffamily Address} represents a particular mailing address with a street number, street, city, country, and postal code. For a more efficient implementation, a unique ID is assigned to each address which allows for faster queries through a single column instead of multiple columns. Note that although postal codes often uniquely identify cities, this is not generally the case especially internationally. We decided not to include the FDs $postal\_code \to city$ and $number, street, city \to postal\_code$ on this basis.

\section*{Normalization}
All of our tables are already in BCNF, and thus in 3NF. This is because the entities on the left-hand-size of all FDs are exactly the primary keys of each table.

Also note that there are no candidate keys other than the primary keys already given.

\section*{SQL DDL}
\begin{verbatim}
CREATE TABLE User (
    Id INT PRIMARY KEY,
    Name VARCHAR(64),
    Email VARCHAR(64),
    Phone CHAR(10),
    Password BINARY(60),
    Address_Id INT
)

CREATE TABLE Holding (
    Holding_Id INT,
    Portfolio_Id INT REFERENCES Portfolio ON DELETE RESTRICT,
    Symbol CHAR(6),
    Exchange CHAR(6),
    Num_Shares INT,
    Date DATE,
    Time TIME,
    Price INT,
    PRIMARY KEY (Holding_Id, Portfolio_Id),
    FOREIGN KEY (Symbol, Exchange) REFERENCES Stock
)

CREATE TABLE Stock (
    Symbol CHAR(6),
    Exchange CHAR(6),
    Name VARCHAR(64),
    PRIMARY KEY (Symbol, Exchange)
)

CREATE TABLE Portfolio (
    Id INT PRIMARY KEY,
    Purpose VARCHAR(64),
    Creation_Date DATE,
    Principal INT,
    Cash INT,
    Owner_Id INT REFERENCES User,
    Manager_Id INT REFERENCES User
)

CREATE TABLE Address (
    Id INT PRIMARY KEY,
    Number CHAR(5),
    Street VARCHAR(32),
    City VARCHAR(32),
    Country VARCHAR(32),
    Postal_Code CHAR(6)
)
\end{verbatim}

Note the {\tt ON DELETE RESTRICT} clause in \textsf{Holding}. This prevents a portfolio from being removed from the table while it still contains active holdings - the investor should sell all assets before closing a portfolio.

\section*{Tables}
\textsf{Stock}
\begin{table}[h!]
	\begin{tabular}{lll}
		\hline\hline\noalign{\vskip 1ex}
		{\textsf{symbol}} & {\textsf{exchange}} & {\textsf{name}} \\ \noalign{\vskip .4ex}\hline\noalign{\vskip .8ex}
		FB & NASDAQ & Facebook Inc \\
		AAPL & NASDAQ & Apple Inc \\
		MSFT & NASDAQ & Microsoft Corporation \\
		GOOGL & NASDAQ & Alphabet Inc \\
		300431 & SHE & Beijing Baofeng Technology Co Ltd \\
		\noalign{\vskip 1ex}\hline
	\end{tabular}
\end{table}

\pagebreak
\textsf{Holding}
\begin{table}[h!]
	\begin{tabular}{llllllll}
		\hline\hline\noalign{\vskip 1ex}
		{\textsf{holding\_id}} & {\textsf{portfolio\_id}} & {\textsf{num\_shares}} & {\textsf{symbol}} & {\textsf{exchange}} & {\textsf{date}} & {\textsf{time}} & {\textsf{price}} \\ \noalign{\vskip .4ex}\hline\noalign{\vskip .8ex}
		1 & 1 & FB & NASDAQ & 300 & 02/01/2016 & 13:23 & 98.63 \\
		2 & 1 & AAPL & NASDAQ & 8000 & 13/06/2011 & 20:34 & 46.56 \\
		1 & 2 & MSFT & NASDAQ & 232 & 27/03/2009 & 12:13 & 18.13 \\
		2 & 3 & GOOGL & NASDAQ & 2938 & 25/06/2010 & 13:08 & 236.57 \\
		3 & 5 & 300431 & SHE & 97832 & 27/03/2015 & 09:03 & 6.22 \\
		\noalign{\vskip 1ex}\hline
	\end{tabular}
\end{table}

\textsf{Portfolio}
\begin{table}[h!]
	\begin{tabular}{lllllll}
		\hline\hline\noalign{\vskip 1ex}
		{\textsf{id}} & {\textsf{purpose}} & {\textsf{creation\_date}} & {\textsf{principal}} & {\textsf{cash}} & {\textsf{owner\_id}} & {\textsf{manager\_id}} \\ \noalign{\vskip .4ex}\hline\noalign{\vskip .8ex}
		1 & investing & 03/01/2015 & 10230 & 124 & 5 & 3 \\
		2 & investing & 08/13/2012 & 400000 & 3728 & 4 & 3 \\
		3 & trading & 10/04/2008 & 23000 & 12039 & 4 & 4 \\
		4 & retirement & 03/29/2007 & 340000 & 28377 & 5 & 2 \\
		5 & bored & 12/25/2004 & 4932000 & 0 & 1 & 1 \\
		\noalign{\vskip 1ex}\hline
	\end{tabular}
\end{table}

\textsf{User}
\begin{table}[h!]
	\begin{tabular}{lllll}
		\hline\hline\noalign{\vskip 1ex}
		{\textsf{id}} & {\textsf{name}} & {\textsf{email}} & {\textsf{phone}} & {\textsf{address}} \\ \noalign{\vskip .4ex}\hline\noalign{\vskip .8ex}
		1 & George Preece & gkp@example.com & 6392840427 & 6271 \\
		2 & Erik Combs & ecombs@example.com & 4382719285 & 3827 \\
		3 & Natalie Bolduc & natalie@example.com & 5837163859 & 285 \\
		4 & Madeleine Nilsen & mnilsen@example.com & 5829774637 & 6834 \\
		5 & Patrik Larsson & patrik@example.com & 7947252898 & 982 \\
		\noalign{\vskip 1ex}\hline
	\end{tabular}
\end{table}

\textsf{Address}
\begin{table}[h!]
	\begin{tabular}{llllll}
		\hline\hline\noalign{\vskip 1ex}
		{\textsf{id}} & {\textsf{number}} & {\textsf{street}} & {\textsf{city}} & {\textsf{country}} & {\textsf{postal\_code}} \\ \noalign{\vskip .4ex}\hline\noalign{\vskip .8ex}
		6271 & 6271 & 32nd St. & New York & US & 10001 \\
		3827 & 3827 & Main St. N & North Royalton & US & 44133 \\
		285 & 285 & Dewhurst Blvd. & Toronto & CA & M4J3J7 \\
		6834 & 6834 & Burrard St. & Vancouver & CA & V6C2E8 \\
		982 & 982 & De Castro St & Road Town & VGB & ~ \\
		\noalign{\vskip 1ex}\hline
	\end{tabular}
\end{table}

Note that in these examples the various IDs may seem to exhibit external constraints, for example the \textsf{id} and \textsf{number} fields in \textsf{Address} are equal. However these patterns will not be enforced or implemented and are only for demonstrative purposes.

\end{document}
